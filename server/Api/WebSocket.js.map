{"version":3,"file":"WebSocket.js","sourceRoot":"","sources":["WebSocket.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,kEAA4C;AAG5C;IAIC,mBAAY,EAAO;QAClB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QAEb,IAAI,CAAC,UAAU,EAAE,CAAC;IACnB,CAAC;IAED,8BAAU,GAAV;QAAA,iBAMC;QALA,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,YAAY,EAAE,UAAO,MAAW;;;;wBAC1C,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;wBAErB,qBAAM,IAAI,CAAC,gBAAgB,EAAE,EAAA;;wBAA7B,SAA6B,CAAC;;;;aAC9B,CAAC,CAAC;IACJ,CAAC;IAEK,oCAAgB,GAAtB;;;;;;wBACC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,WAAW,EAAE,cAAM,OAAA,KAAK,KAAI,CAAC,SAAS,EAAE,EAArB,CAAqB,CAAC,CAAC;wBACzD,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,UAAU,EACxB,UAAC,cAAsB,IAAK,OAAA,KAAK,KAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAlC,CAAkC,CAAC,CAAC;wBACjE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY,EAC1B,UAAC,OAAuB,IAAK,OAAA,KAAK,KAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAA7B,CAA6B,CAAC,CAAC;wBAC7D,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,YAAY,EAC1B,UAAC,cAAsB,IAAK,OAAA,KAAK,KAAI,CAAC,UAAU,CAAC,cAAc,CAAC,EAApC,CAAoC,CAAC,CAAC;wBAEnE,qBAAM,IAAI,CAAC,QAAQ,EAAE,EAAA;;wBAArB,SAAqB,CAAC;;;;;KACtB;IAED,6BAAS,GAAT,UAAU,KAAa;QACtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;IACtC,CAAC;IAEK,4BAAQ,GAAd;;;;;;;wBAEe,qBAAM,kBAAQ,CAAC,OAAO,EAAE,EAAA;;wBAA/B,IAAI,GAAG,SAAwB;wBACrC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;;;;wBAElC,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;;;;;;KAEnC;IAEK,iCAAa,GAAnB;;;;;;;wBAEe,qBAAM,kBAAQ,CAAC,OAAO,EAAE,EAAA;;wBAA/B,IAAI,GAAG,SAAwB;wBACrC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;;;;wBAEtC,IAAI,CAAC,SAAS,CAAC,wBAAwB,CAAC,CAAC;;;;;;KAE1C;IAEK,6BAAS,GAAf;;;;;;;wBAEE,qBAAM,kBAAQ,CAAC,SAAS,EAAE,EAAA;;wBAA1B,SAA0B,CAAC;wBAC3B,qBAAM,IAAI,CAAC,aAAa,EAAE,EAAA;;wBAA1B,SAA0B,CAAC;;;;wBAE3B,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;;;;;;KAEpC;IAEK,4BAAQ,GAAd,UAAe,cAAsB;;;;;;;wBAEnC,qBAAM,kBAAQ,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAA;;wBAAvC,SAAuC,CAAC;wBACxC,qBAAM,IAAI,CAAC,aAAa,EAAE,EAAA;;wBAA1B,SAA0B,CAAC;;;;wBAE3B,IAAI,CAAC,SAAS,CAAC,iBAAiB,CAAC,CAAC;;;;;;KAEnC;IAEK,8BAAU,GAAhB,UAAiB,OAAuB;;;;;;;wBAE/B,WAAW,GAAiB,OAAO,YAAxB,EAAE,WAAW,GAAI,OAAO,YAAX,CAAY;wBAC3C,qBAAM,kBAAQ,CAAC,UAAU,CAAC,WAAW,EAAE,WAAW,CAAC,EAAA;;wBAAnD,SAAmD,CAAC;wBACpD,qBAAM,IAAI,CAAC,aAAa,EAAE,EAAA;;wBAA1B,SAA0B,CAAC;;;;wBAE3B,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;;;;;;KAErC;IAEK,8BAAU,GAAhB,UAAiB,cAAsB;;;;;;;wBAErC,qBAAM,kBAAQ,CAAC,UAAU,CAAC,cAAc,CAAC,EAAA;;wBAAzC,SAAyC,CAAC;wBAC1C,qBAAM,IAAI,CAAC,aAAa,EAAE,EAAA;;wBAA1B,SAA0B,CAAC;;;;wBAE3B,IAAI,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;;;;;;KAErC;IACF,gBAAC;AAAD,CAAC,AAxFD,IAwFC","sourcesContent":["import Database from '../database/Database';\r\nimport {DishUpdateData} from '../common/types';\r\n\r\nexport default class WebSocket {\r\n\tclient: any;\r\n\tio: any;\r\n\r\n\tconstructor(io: any) {\r\n\t\tthis.io = io;\r\n\r\n\t\tthis.initSocket();\r\n\t}\r\n\r\n\tinitSocket() {\r\n\t\tthis.io.on('connection', async (client: any) => {\r\n\t\t\tthis.client = client;\r\n\r\n\t\t\tawait this.initMenuRequests();\r\n\t\t});\r\n\t}\r\n\r\n\tasync initMenuRequests() {\r\n\t\tthis.client.on('clearMenu', () => void this.clearMenu());\r\n\t\tthis.client.on('saveDish',\r\n\t\t\t(dishCreateName: string) => void this.saveDish(dishCreateName));\r\n\t\tthis.client.on('updateDish',\r\n\t\t\t(payload: DishUpdateData) => void this.updateDish(payload));\r\n\t\tthis.client.on('deleteDish',\r\n\t\t\t(dishDeleteName: string) => void this.deleteDish(dishDeleteName));\r\n\r\n\t\tawait this.emitMenu();\r\n\t}\r\n\r\n\temitError(error: string) {\r\n\t\tthis.client.emit('menuError', error);\r\n\t}\r\n\r\n\tasync emitMenu() {\r\n\t\ttry {\r\n\t\t\tconst menu = await Database.getMenu();\r\n\t\t\tthis.client.emit('getMenu', menu);\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Emit menu error');\r\n\t\t}\r\n\t}\r\n\r\n\tasync emitMenuToAll() {\r\n\t\ttry {\r\n\t\t\tconst menu = await Database.getMenu();\r\n\t\t\tthis.io.sockets.emit('getMenu', menu);\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Emit menu to all error');\r\n\t\t}\r\n\t}\r\n\r\n\tasync clearMenu() {\r\n\t\ttry {\r\n\t\t\tawait Database.clearMenu();\r\n\t\t\tawait this.emitMenuToAll();\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Menu clear error');\r\n\t\t}\r\n\t}\r\n\r\n\tasync saveDish(dishCreateName: string) {\r\n\t\ttry {\r\n\t\t\tawait Database.saveDish(dishCreateName);\r\n\t\t\tawait this.emitMenuToAll();\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Dish save error');\r\n\t\t}\r\n\t}\r\n\r\n\tasync updateDish(payload: DishUpdateData) {\r\n\t\ttry {\r\n\t\t\tconst {oldDishName, newDishName} = payload;\r\n\t\t\tawait Database.updateDish(oldDishName, newDishName);\r\n\t\t\tawait this.emitMenuToAll();\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Dish update error');\r\n\t\t}\r\n\t}\r\n\r\n\tasync deleteDish(dishDeleteName: string) {\r\n\t\ttry {\r\n\t\t\tawait Database.deleteDish(dishDeleteName);\r\n\t\t\tawait this.emitMenuToAll();\r\n\t\t} catch (e) {\r\n\t\t\tthis.emitError('Dish delete error');\r\n\t\t}\r\n\t}\r\n}\r\n"]}