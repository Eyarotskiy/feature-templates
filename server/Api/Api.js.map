{"version":3,"file":"Api.js","sourceRoot":"","sources":["Api.ts"],"names":[],"mappings":"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","sourcesContent":["import path from 'path';\r\nimport {Application, NextFunction, Request, Response} from 'express';\r\nimport {CLIENT_BUILD_DIRECTORY, JWT_SECRET} from '../common/constants';\r\nimport {ApiResponse} from '../common/types';\r\nimport DataApi from './DataApi/DataApi';\r\nimport FileApi from './FileApi/FileApi';\r\nimport AuthorizationApi from './AuthorizationApi/AuthorizationApi';\r\nimport MenuApi from './MenuApi/MenuApi';\r\nimport Log from '../Log/Log';\r\nconst jwt = require('jsonwebtoken');\r\n\r\nclass Api {\r\n\tinitApiRequests(app: Application) {\r\n\t\tapp.get('/api/menu/get', MenuApi.handleMenuGetRequest);\r\n\t\tapp.post('/api/dish/save', MenuApi.handleDishSaveRequest);\r\n\t\tapp.post('/api/dish/update', MenuApi.handleDishUpdateRequest);\r\n\t\tapp.post('/api/dish/delete', MenuApi.handleDishDeleteRequest);\r\n\t\tapp.post('/api/menu/clear', MenuApi.handleMenuClearRequest);\r\n\t\tapp.get('/api/data/get', DataApi.handleDataGetRequest);\r\n\t\tapp.get('/api/users/get', DataApi.handleUsersGetRequest);\r\n\t\tapp.post('/api/file/upload', FileApi.handleFileUploadRequest);\r\n\t\tapp.post('/api/login/signIn', AuthorizationApi.handleSignInRequest);\r\n\t\tapp.get('/api/login/authenticate', AuthorizationApi.handleAuthenticateRequest);\r\n\t\tapp.post('/api/login/signUp', AuthorizationApi.handleSignUpRequest);\r\n\t\tapp.get('/*', this.handleRootRequest);\r\n\t}\r\n\r\n\tsendSuccess(res: Response, data: object|null = {}) {\r\n\t\tres.status(200).json(data);\r\n\t}\r\n\r\n\tasync sendError(res: Response, code: number, error: any) {\r\n\t\tconst response: ApiResponse = {\r\n\t\t\tcode,\r\n\t\t\tmessage: error.message,\r\n\t\t\tstack: error.stack,\r\n\t\t};\r\n\r\n\t\tawait Log.logErrorToFile(response);\r\n\t\tres.status(code).send(response);\r\n\t}\r\n\r\n\tauthenticateToken(req: Request, res: Response, next: NextFunction) {\r\n\t\tconst token = req.headers['auth-token'];\r\n\r\n\t\tconst handleVerification = (err: any, user: any) => {\r\n\t\t\tif (err) {\r\n\t\t\t\tthis.sendError(res, 401, err);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnext();\r\n\t\t};\r\n\r\n\t\tjwt.verify(token, JWT_SECRET, handleVerification);\r\n\t}\r\n\r\n\tgenerateToken(userName: string) {\r\n\t\tconst name = {name: userName};\r\n\t\tconst expiration = {'expiresIn': '1d'};\r\n\t\treturn jwt.sign(name, JWT_SECRET, expiration);\r\n\t}\r\n\r\n\tprivate async handleRootRequest(req: Request, res:Response): Promise<void> {\r\n\t\ttry {\r\n\t\t\tres.sendFile(path.join(CLIENT_BUILD_DIRECTORY, 'index.html'));\r\n\t\t} catch (error) {\r\n\t\t\tthis.sendError(res, 400, error);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default new Api(); \r\n"]}